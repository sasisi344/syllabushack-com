{{ define "main" }}
{{- $readMore := (T "readMore") | default "Read more â†’" -}}
<div class="hx:mx-auto hx:flex hextra-max-page-width">
  {{ partial "sidebar.html" (dict "context" . "disableSidebar" true "displayPlaceholder" true) }}
  <article
    class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
    <main class="hx:w-full hx:min-w-0 hextra-max-content-width hx:px-6 hx:pt-4 hx:md:px-12">
      {{ partial "breadcrumb.html" (dict "page" . "enable" false) }}
      <br class="hx:mt-1.5 hx:text-sm" />
      {{ if .Title }}<h1
        class="hx:text-center hx:mt-2 hx:text-4xl hx:font-bold hx:tracking-tight hx:text-slate-900 hx:dark:text-slate-100">
        {{ .Title }}</h1>{{ end }}
      <div class="content">{{ .Content }}</div>

      {{- if eq .RelPermalink "/blog/" -}}
      {{/* Blog Index: Categories Redesign with Forced Grid */}}
      <style>
        .blog-category-grid {
          display: grid;
          grid-template-columns: 1fr;
          gap: 1.5rem;
          margin: 2rem 0 4rem 0;
        }

        @media (min-width: 768px) {
          .blog-category-grid {
            grid-template-columns: repeat(3, 1fr);
          }
        }

        .blog-category-card {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 1.5rem;
          text-align: center;
          border-radius: 0.75rem;
          border: 1px solid #e5e7eb;
          transition: all 0.3s ease;
          text-decoration: none;
          color: inherit;
          background: white;
          min-height: 180px;
        }

        .dark .blog-category-card {
          background: #111;
          border-color: #262626;
        }

        .blog-category-card:hover {
          border-color: #3b82f6;
          transform: translateY(-4px);
        }

        .category-media-box {
          width: 100%;
          aspect-ratio: 16 / 9;
          overflow: hidden;
          border-radius: 0.5rem;
          margin-bottom: 1rem;
          background: #f9fafb;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .dark .category-media-box {
          background: #1c1c1c;
        }

        .category-media-box img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        }

        .blog-category-card:hover .category-media-box img {
          transform: scale(1.05);
        }

        .category-emoji {
          font-size: 3rem;
          transition: transform 0.3s ease;
        }

        .blog-category-card:hover .category-emoji {
          transform: scale(1.1);
        }

        .category-card-title {
          font-weight: bold;
          font-size: 1.1rem;
          margin: 0;
        }
      </style>

      <div class="hx:mt-12">
        <h2 class="hx:text-2xl hx:font-bold hx:mb-6 hx:text-center">Categories</h2>
        <div class="blog-category-grid">
          {{- range (where .Pages "Kind" "section") }}
          {{- $sec := .Section -}}
          {{- $image := .Params.image | default .Params.thumbnail -}}
          <a href="{{ .RelPermalink }}" class="blog-category-card">
            <div class="category-media-box">
              {{- if $image -}}
              {{- $imgResource := .Resources.Get $image -}}
              {{- if $imgResource -}}
              {{- $processed := $imgResource.Fill "400x225 Center webp q80" -}}
              <img src="{{ $processed.RelPermalink }}" alt="{{ .Title }}">
              {{- else -}}
              <img src="{{ relURL $image }}" alt="{{ .Title }}">
              {{- end -}}
              {{- else -}}
              <div class="category-emoji">
                {{- if eq $sec "career" }}ðŸ’¼{{- else if eq $sec "method" }}ðŸ§ {{- else if eq $sec "trend" }}ðŸ“ˆ{{- else
                }}ðŸ“„{{- end -}}
              </div>
              {{- end -}}
            </div>
            <h3 class="category-card-title">{{ .Title }}</h3>
          </a>
          {{- end }}
        </div>
      </div>

      <div class="hx:mt-16 hx:mb-8 hx:border-b hx:border-gray-100 hx:dark:border-neutral-800 hx:pb-2">
        <h2 class="hx:text-2xl hx:font-bold">Latest Articles</h2>
      </div>
      {{- end -}}

      {{/* Standard Blog List (Sub-categories or root fallback) */}}
      {{- $pages := partial "utils/sort-pages" (dict "page" . "by" site.Params.blog.list.sortBy "order"
      site.Params.blog.list.sortOrder) -}}
      {{- $pagerSize := site.Params.blog.list.pagerSize | default 10 -}}
      {{- $paginator := .Paginate $pages $pagerSize -}}

      <div class="hx:mt-8">
        {{- range $paginator.Pages }}
        <div class="hx:mb-10">
          <h3><a style="color: inherit; text-decoration: none;"
              class="hx:block hx:font-semibold hx:mt-8 hx:text-2xl hx:hover:text-primary-600 hx:transition-colors"
              href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
          <p class="hx:opacity-80 hx:mt-4 hx:leading-7">{{- partial "utils/page-description" . -}}</p>
          <p class="hx:opacity-50 hx:text-sm hx:mt-4 hx:leading-7">{{ partial "utils/format-date" .Date }}</p>
        </div>
        {{ end -}}
      </div>

      {{- if gt $paginator.TotalPages 1 -}}
      {{ partial "components/blog-pager.html" $paginator }}
      {{- end -}}
    </main>
  </article>
  <div class="hx:max-xl:hidden hx:h-0 hx:w-64 hx:shrink-0"></div>
</div>
{{ end }}