import json
import os
import datetime
import random

# Configuration
SYLLABUS_FILE = 'tools/hack_agent/syllabus_sample.json'
OUTPUT_CONTENT_DIR = 'content/docs/hack_prototype'
OUTPUT_DATA_DIR = 'static/data/generated'
START_DATE = datetime.date(2026, 1, 25)
# EXAM_DATE = datetime.date(2026, 4, 19) 
DAYS_TO_GENERATE = 3  # Generate only 3 days for prototype

def load_syllabus():
    with open(SYLLABUS_FILE, 'r', encoding='utf-8') as f:
        return json.load(f)

def generate_mock_questions(topic):
    """
    In a real scenario, this would call an LLM API:
    response = llm.generate(f"Create 3 difficult questions about {topic['title']}...")
    """
    questions = []
    for i in range(3):
        questions.append({
            "id": f"{topic['id']}_q{i+1}",
            "question": f"ã€AIç”Ÿæˆã€‘{topic['title']} ã«é–¢ã™ã‚‹å®Ÿè·µå•é¡Œ {i+1}",
            "options": [
                f"{topic['title']}ã®æ­£ã—ã„è¨˜è¿°A",
                f"{topic['title']}ã®èª¤ã£ãŸè¨˜è¿°B",
                f"{topic['title']}ã®èª¤ã£ãŸè¨˜è¿°C",
                f"{topic['title']}ã®èª¤ã£ãŸè¨˜è¿°D"
            ],
            "answer_index": 0,
            "explanation": f"ã“ã‚Œã¯AIãŒã‚·ãƒ©ãƒã‚¹ã€Œ{topic['description']}ã€ã«åŸºã¥ã„ã¦ç”Ÿæˆã—ãŸè§£èª¬ã§ã™ã€‚æ­£è§£ã¯Aã§ã™ã€‚",
            "difficulty": topic['weight'],
            "tags": ["AIç”Ÿæˆ", topic['title']]
        })
    return questions

def create_daily_content(date, topic, day_number):
    date_str = date.strftime('%Y-%m-%d')
    file_id = f"day_{day_number:03d}"  # e.g., day_001
    
    # 1. Generate Quiz Data (JSON)
    questions = generate_mock_questions(topic)
    json_filename = f"{file_id}.json"
    json_path = os.path.join(OUTPUT_DATA_DIR, json_filename)
    
    os.makedirs(OUTPUT_DATA_DIR, exist_ok=True)
    with open(json_path, 'w', encoding='utf-8') as f:
        json.dump(questions, f, indent=4, ensure_ascii=False)
    print(f"Generated Quiz Data: {json_path}")

    # 2. Generate Article (Markdown)
    md_filename = f"{file_id}.md"
    md_path = os.path.join(OUTPUT_CONTENT_DIR, md_filename)
    
    os.makedirs(OUTPUT_CONTENT_DIR, exist_ok=True)
    
    md_content = f"""---
title: "Day {day_number}: {topic['title']}"
date: {date_str}
draft: false
tags: ["SyllabusHack", "Day{day_number}", "{topic['title']}"]
summary: "ã€AIå…ˆç”Ÿã®æŒ‡å°ã€‘ä»Šæ—¥ã¯ã€Œ{topic['title']}ã€ã‚’å®Œç’§ã«ã—ã¾ã—ã‚‡ã†ã€‚"
---

## ğŸ‘©â€ğŸ« æœ¬æ—¥ã®å­¦ç¿’ãƒ†ãƒ¼ãƒ: {topic['title']}

ã“ã‚“ã«ã¡ã¯ï¼ã‚ãªãŸã®AIãƒãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚
è©¦é¨“ã¾ã§ã‚ã¨å°‘ã—ã€‚ä»Šæ—¥ã¯ã‚·ãƒ©ãƒã‚¹ã®**ã€Œ{topic['title']}ã€**ã«ã¤ã„ã¦é›†ä¸­çš„ã«æ”»æ’ƒã—ã¾ã™ã€‚

### ğŸ“Œ ã‚·ãƒ©ãƒã‚¹ã®å®šç¾©
> {topic['description']}

### âš”ï¸ AIç”Ÿæˆï¼šæœ¬æ—¥ã®å®Ÿæˆ¦å•é¡Œ
ç§ãŒéå»å•ã®å‚¾å‘ã‚’åˆ†æã—ã€**ã‚ãªãŸã®å¼±ç‚¹ã«ãªã‚Šãã†ãªãƒã‚¤ãƒ³ãƒˆ**ã‚’å•é¡Œã«ã—ã¾ã—ãŸã€‚
å…¨å•æ­£è§£ã™ã‚‹ã¾ã§å¸°ã‚Œã¾ã›ã‚“ã‚ˆï¼Ÿ

{{{{< quiz category="generated/{file_id}" >}}}}

---
*Generated by Syllabus Hack Agent Teacher*
"""
    with open(md_path, 'w', encoding='utf-8') as f:
        f.write(md_content)
    print(f"Generated Article: {md_path}")

def main():
    syllabus = load_syllabus()
    topics = syllabus['topics']
    
    print(f"ğŸ¤– Agent Teacher Initialized.")
    print(f"ğŸ“š Course: {syllabus['exam_name']}")
    print(f"ğŸ“… Start Date: {START_DATE}")
    
    # Simple Scheduler: 1 Topic per Day
    current_date = START_DATE
    
    for i in range(DAYS_TO_GENERATE):
        topic = topics[i % len(topics)]
        create_daily_content(current_date, topic, i + 1)
        current_date += datetime.timedelta(days=1)
        
    print("âœ… Prototype Content Generation Complete!")

if __name__ == "__main__":
    main()
